<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InsightForge</title>
    <link rel="stylesheet" href="./styles/main.css" />
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  </head>

  <body>
    <header class="topbar">
      <h1>InsightForge</h1>
      <div class="status" id="status">Ready</div>
    </header>

    <main class="layout">
      <aside class="sidebar">
        <section class="card">
          <h2>Dataset</h2>

          <label class="button">
            Upload CSV
            <input id="fileInput" type="file" accept=".csv,text/csv" hidden />
          </label>

          <button class="secondary" id="helpBtn" type="button">
            Dataset help
          </button>

          <div class="meta" id="datasetMeta">
            <p><strong>No dataset loaded</strong></p>
            <p>Upload a CSV to begin.</p>
          </div>
        </section>

        <section class="card">
          <h2>Scatter controls</h2>

          <div class="row compact">
            <label for="xSelect">X:</label>
            <select id="xSelect" disabled></select>
          </div>

          <div class="row compact">
            <label for="ySelect">Y:</label>
            <select id="ySelect" disabled></select>
          </div>

          <div class="row row-inline">
            <input type="checkbox" id="normaliseToggle" />
            <label for="normaliseToggle">Normalise numeric columns (0-1)</label>
          </div>

          <button class="secondary" id="renderBtn" disabled>
            Render scatter
          </button>

          <p class="hint">
            Select columns for the X and Y axes, then click "Render scatter" to
            generate the plot.
          </p>
        </section>
        <section class="card">
          <h2>Clustering (K-Means)</h2>
          <div class="row">
            <label for="kInput">Number of clusters (k):</label>
            <input type="number" id="kInput" value="3" min="2" max="10" />
          </div>
          <label for="featureSelect" class="label"
            >Features (2-8 recommended)</label
          >
          <select id="featureSelect" multiple size="8" disabled></select>
          <button class="secondary" id="runKMeansBtn" disabled>
            Perform K-Means Clustering
          </button>
          <p class="hint" id="kmeansStatus">
            Select features to use for clustering, set the number of clusters,
            then click "Perform K-Means Clustering".
          </p>
        </section>
      </aside>

      <section class="workspace">
        <div class="card">
          <h2>Preview</h2>
          <div class="tableWrap">
            <table id="previewTable">
              <thead></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h2>Scatterplot</h2>
          <div id="chart" class="chart"></div>
        </div>
      </section>
    </main>

    <div class="modalOverlay" id="helpModal" aria-hidden="true">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="helpTitle"
      >
        <div class="modalHeader">
          <h2 id="helpTitle">What CSV files work best?</h2>
          <button
            class="iconBtn"
            id="helpCloseBtn"
            type="button"
            aria-label="Close"
          >
            ✕
          </button>
        </div>

        <div class="modalBody">
          <p>
            InsightForge accepts <strong>.csv</strong> files with a
            <strong>header row</strong>. The app automatically detects numeric
            columns and uses them for plotting and clustering.
          </p>

          <h3>Recommended CSV format</h3>
          <ul>
            <li><strong>Row 1 must be column names</strong> (headers)</li>
            <li>Use commas to separate values</li>
            <li>
              Include <strong>at least 2 numeric columns</strong> (for
              scatterplot)
            </li>
            <li>For K-means, select <strong>2–8 numeric features</strong></li>
          </ul>

          <h3>Example</h3>
          <pre class="codeBlock">
age,studytime,G1,G2,G3
18,2,10,12,13
17,3,11,11,12</pre
          >
          <p>
            <strong>Example dataset:</strong><br />
            <a
              href="https://archive.ics.uci.edu/ml/datasets/Student+Performance"
              target="_blank"
              rel="noopener"
              style="color: var(--accent)"
            >
              Student Performance Dataset (UCI Machine Learning Repository)
            </a>
          </p>

          <h3>Common issues</h3>
          <ul>
            <li>
              If no numeric columns are detected, check for non-numeric text
              (e.g., "12 points").
            </li>
            <li>
              If your CSV uses semicolons (;), convert to comma-separated
              format.
            </li>
            <li>Very large datasets may be truncated for performance.</li>
          </ul>

          <p class="smallMuted">
            Tip: Try the included student performance dataset to see the
            expected structure.
          </p>
        </div>
      </div>
    </div>

    <script type="module" src="./js/main.js"></script>
  </body>
</html>
